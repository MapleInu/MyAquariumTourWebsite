<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê∞¥ÊóèÈ§®Â∑°„Çä„ÅÆË®òÈå≤</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Kaku Gothic Pro', '„Éí„É©„ÇÆ„ÉéËßí„Ç¥ Pro W3', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .map-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .map-section h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        #map {
            height: 400px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .aquarium-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .aquarium-list h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .aquarium-item {
            background: linear-gradient(135deg, #f8fbff 0%, #e8f4f8 100%);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .aquarium-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }
        
        .aquarium-item.selected {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }
        
        .aquarium-item h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .aquarium-item .location {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .detail-panel {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .detail-panel.active {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .detail-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
        }
        
        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .photo-section {
            text-align: center;
        }
        
        .photo-preview {
            width: 100%;
            height: 200px;
            background: #ecf0f1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            border: 2px dashed #bdc3c7;
            transition: all 0.3s ease;
        }
        
        .photo-preview:hover {
            border-color: #3498db;
            background: #f8fbff;
        }
        
        .photo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .comment-section textarea {
            width: 100%;
            height: 150px;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 1rem;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .comment-section textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }
        
        .save-btn {
            background: linear-gradient(45deg, #27ae60, #219a52);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .auth-overlay.active {
            display: flex;
        }
        
        .auth-modal {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .auth-modal h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .auth-modal p {
            color: #7f8c8d;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .auth-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }
        
        .auth-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .auth-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .auth-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .auth-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .auth-btn.secondary {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .auth-btn.secondary:hover {
            background: #d5dbdb;
        }
        
        .edit-controls {
            display: none;
        }
        
        .edit-controls.visible {
            display: block;
        }
        
        .readonly-mode {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .add-aquarium-btn {
            background: linear-gradient(45deg, #27ae60, #219a52);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            font-weight: 600;
            display: none; /* ÂàùÊúüÁä∂ÊÖã„Åß„ÅØÈùûË°®Á§∫ */
        }
        
        .add-aquarium-btn.visible {
            display: block; /* Á∑®ÈõÜ„É¢„Éº„ÉâÊôÇ„Å´Ë°®Á§∫ */
        }
        
        .add-aquarium-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }
        
        .add-aquarium-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .add-form {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e9ecef;
        }
        
        .add-form.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }
        
        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .form-btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .form-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .form-btn.secondary {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
        }
        
        .auth-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 0.8rem 1.2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .login-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.8rem;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.6);
            transition: all 0.3s ease;
            z-index: 100;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .login-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 12px 30px rgba(52, 152, 219, 0.8);
            background: linear-gradient(45deg, #2980b9, #1f4e79);
        }
        
        .login-btn:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        /* „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÁî®„ÅÆË™øÊï¥ */
        @media (hover: none) and (pointer: coarse) {
            .login-btn {
                width: 80px;
                height: 80px;
                font-size: 2rem;
                bottom: 30px;
                right: 30px;
            }
            
            .login-btn:active {
                transform: scale(0.95);
                background: linear-gradient(45deg, #2980b9, #1f4e79);
            }
        }
        
        .stats {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            text-align: center;
            margin-top: 1rem;
        }
        
        .stats h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #f8fbff 0%, #e8f4f8 100%);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 1.5rem;
            }
            
            .detail-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            .map-section, .aquarium-list {
                padding: 1rem;
            }
            
            #map {
                height: 300px;
            }
            
            .aquarium-list {
                max-height: 400px;
            }
            
            .detail-panel {
                margin: 0 0.5rem;
                padding: 1.5rem;
            }
            
            .auth-status {
                top: 10px;
                right: 10px;
                font-size: 0.9rem;
                padding: 0.6rem 1rem;
            }
            
            .login-btn {
                bottom: 20px;
                right: 20px;
                width: 70px;
                height: 70px;
                font-size: 1.6rem;
            }
            
            .auth-modal {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .stat-item {
                padding: 1rem;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 1.5rem 0;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 0.5rem;
                gap: 1rem;
            }
            
            .map-section, .aquarium-list, .detail-panel, .stats {
                border-radius: 15px;
                padding: 1rem;
            }
            
            #map {
                height: 250px;
                border-radius: 10px;
            }
            
            .aquarium-list {
                max-height: 300px;
            }
            
            .aquarium-item {
                padding: 0.8rem;
                margin-bottom: 0.8rem;
                border-radius: 10px;
            }
            
            .aquarium-item h3 {
                font-size: 1rem;
            }
            
            .detail-header h2 {
                font-size: 1.4rem;
            }
            
            .close-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .photo-preview {
                height: 150px;
                border-radius: 10px;
            }
            
            .comment-section textarea {
                height: 120px;
                border-radius: 10px;
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            
            .upload-btn, .save-btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
                border-radius: 20px;
            }
            
            .auth-status {
                top: 8px;
                right: 8px;
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
                border-radius: 20px;
            }
            
            .login-btn {
                bottom: 15px;
                right: 15px;
                width: 60px;
                height: 60px;
                font-size: 1.4rem;
            }
            
            .auth-modal {
                padding: 1rem;
                border-radius: 15px;
            }
            
            .auth-modal h3 {
                font-size: 1.1rem;
            }
            
            .auth-input {
                padding: 0.8rem;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            .auth-btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
                border-radius: 20px;
            }
            
            .add-aquarium-btn {
                width: auto;
                padding: 0.8rem 1.5rem;
                font-size: 0.9rem;
                margin-bottom: 0.8rem;
            }
            
            .add-form {
                padding: 1rem;
                border-radius: 10px;
            }
            
            .form-group {
                margin-bottom: 0.8rem;
            }
            
            .form-group input, .form-group textarea {
                padding: 0.7rem;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            .form-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .form-btn {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            
            .stat-item {
                padding: 0.8rem;
                border-radius: 10px;
            }
            
            .stat-number {
                font-size: 1.3rem;
            }
            
            .stat-label {
                font-size: 0.9rem;
            }
        }
        
        /* „Çø„Éñ„É¨„ÉÉ„ÉàÊ®™Âêë„ÅçÂØæÂøú */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            #map {
                height: 350px;
            }
            
            .login-btn {
                width: 75px;
                height: 75px;
                font-size: 1.7rem;
                bottom: 25px;
                right: 25px;
            }
        }
        
        /* È´òËß£ÂÉèÂ∫¶„Éá„Ç£„Çπ„Éó„É¨„Ç§ÂØæÂøú */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .login-btn {
                box-shadow: 0 10px 30px rgba(52, 152, 219, 0.7);
            }
            
            .auth-status {
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üê† Ê∞¥ÊóèÈ§®Â∑°„Çä„ÅÆË®òÈå≤ üê†</h1>
        <p>‰ªä„Åæ„Åß„Å´Ë°å„Å£„ÅüÊ∞¥ÊóèÈ§®„ÅÆÊÄù„ÅÑÂá∫</p>
    </div>
    
    <div class="container">
        <div class="map-section">
            <h2>üìç Ë®™Âïè„Åó„ÅüÊ∞¥ÊóèÈ§®„Éû„ÉÉ„Éó</h2>
            <div id="map"></div>
        </div>
        
        <div class="aquarium-list">
            <h2>üèõÔ∏è Ê∞¥ÊóèÈ§®„É™„Çπ„Éà</h2>
            <button class="add-aquarium-btn" id="add-aquarium-btn" onclick="toggleAddForm()">
                ‚ûï Êñ∞„Åó„ÅÑÊ∞¥ÊóèÈ§®„ÇíËøΩÂä†
            </button>
            <div class="add-form" id="add-form">
                <div class="form-group">
                    <label for="new-name">Ê∞¥ÊóèÈ§®Âêç</label>
                    <input type="text" id="new-name" placeholder="‰æãÔºöÊµ∑ÈÅäÈ§®">
                </div>
                <div class="form-group">
                    <label for="new-location">ÊâÄÂú®Âú∞Ôºà‰ΩèÊâÄÔºâ</label>
                    <input type="text" id="new-location" placeholder="‰æãÔºöÂ§ßÈò™Â∫úÂ§ßÈò™Â∏ÇÊ∏ØÂå∫Êµ∑Â≤∏ÈÄö1-1-10">
                    <small style="color: #7f8c8d; font-size: 0.8rem;">
                        üí° Ë©≥Á¥∞„Å™‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åô„Çã„Å®„ÄÅ„Çà„ÇäÊ≠£Á¢∫„Å™‰ΩçÁΩÆ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                    </small>
                </div>
                <div class="form-group">
                    <label for="new-description">Ë™¨Êòé</label>
                    <textarea id="new-description" rows="2" placeholder="Ê∞¥ÊóèÈ§®„ÅÆÁâπÂæ¥„ÇÑÈ≠ÖÂäõ"></textarea>
                </div>
                <div class="form-buttons">
                    <button class="form-btn secondary" onclick="cancelAddForm()">„Ç≠„É£„É≥„Çª„É´</button>
                    <button class="form-btn primary" onclick="addNewAquarium()" id="add-btn">ËøΩÂä†</button>
                </div>
            </div>
            <div id="aquarium-items"></div>
        </div>
        
        <div class="detail-panel" id="detail-panel">
            <div class="detail-header">
                <h2 id="detail-title"></h2>
                <button class="close-btn" onclick="closeDetail()">√ó</button>
            </div>
            <div class="detail-content">
                <div class="photo-section">
                    <h3>üì∏ ÂÜôÁúü</h3>
                    <div class="photo-preview" id="photo-preview">
                        ÂÜôÁúü„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                    </div>
                    <div class="edit-controls" id="photo-controls">
                        <input type="file" class="file-input" id="photo-input" accept="image/*">
                        <button class="upload-btn" onclick="document.getElementById('photo-input').click()">
                            üì∑ ÂÜôÁúü„ÇíÈÅ∏Êäû
                        </button>
                    </div>
                </div>
                <div class="comment-section">
                    <h3>üí≠ „Ç≥„É°„É≥„Éà„ÉªÊÑüÊÉ≥</h3>
                    <textarea id="comment-textarea" placeholder="„Åì„ÅÆÊ∞¥ÊóèÈ§®„Åß„ÅÆÊÄù„ÅÑÂá∫„ÇÑÊÑüÊÉ≥„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ..." readonly></textarea>
                    <div class="edit-controls" id="comment-controls">
                        <button class="save-btn" onclick="saveData()">üíæ ‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ë™çË®º„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-modal">
            <h3>üîê Á∑®ÈõÜÊ®©Èôê„ÅåÂøÖË¶Å„Åß„Åô</h3>
            <p>ÂÜôÁúü„ÇÑ„Ç≥„É°„É≥„Éà„ÇíÁ∑®ÈõÜ„Åô„Çã„Å´„ÅØ„ÄÅ„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆÂÖ•Âäõ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ</p>
            <input type="password" class="auth-input" id="password-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
            <div class="auth-buttons">
                <button class="auth-btn primary" onclick="authenticate()">„É≠„Ç∞„Ç§„É≥</button>
                <button class="auth-btn secondary" onclick="closeAuth()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>
    
    <!-- Ë™çË®ºÁä∂Ê≥ÅË°®Á§∫ -->
    <div class="auth-status" id="auth-status">
        Èñ≤Ë¶ß„É¢„Éº„Éâ
    </div>
    
    <!-- „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥ -->
    <button class="login-btn" onclick="showAuth()" title="Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥">
        üîì
    </button>
    
    <div class="stats">
        <h2>üìä Ë®™ÂïèÁµ±Ë®à</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">8</div>
                <div class="stat-label">Ë®™Âïè„Åó„ÅüÊ∞¥ÊóèÈ§®Êï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">6</div>
                <div class="stat-label">ÈÉΩÈÅìÂ∫úÁúå</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="photos-count">0</div>
                <div class="stat-label">„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÜôÁúüÊï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="comments-count">0</div>
                <div class="stat-label">„Ç≥„É°„É≥„ÉàÊäïÁ®øÊï∞</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Leaflet„É©„Ç§„Éñ„É©„É™„ÅåÁ¢∫ÂÆü„Å´Ë™≠„ÅøËæº„Åæ„Çå„Çã„Åæ„ÅßÂæÖÊ©ü
        function waitForLeaflet() {
            return new Promise((resolve) => {
                if (typeof L !== 'undefined') {
                    resolve();
                } else {
                    setTimeout(() => waitForLeaflet().then(resolve), 50);
                }
            });
        }
        // GitHub GistÈÄ£Êê∫„ÇØ„É©„Çπ
        class AquariumDataSync {
            constructor() {
                // TODO: Âæå„ÅßË®≠ÂÆö„Åô„Çã„Éà„Éº„ÇØ„É≥„Å®Gist ID
                this.GITHUB_TOKEN = ''; // Âæå„ÅßË®≠ÂÆö
                this.GIST_ID = ''; // Âæå„ÅßË®≠ÂÆö
                this.SYNC_INTERVAL = 30000; // 30Áßí„Åî„Å®
            }

            async saveToGist(data) {
                if (!this.GITHUB_TOKEN || !this.GIST_ID) {
                    console.log('GistË®≠ÂÆö„Åå„Åæ„Å†„Åß„Åô - „É≠„Éº„Ç´„É´‰øùÂ≠ò„ÅÆ„Åø');
                    return true; // „É≠„Éº„Ç´„É´‰øùÂ≠ò„ÅØÊàêÂäüÊâ±„ÅÑ
                }

                try {
                    const response = await fetch(`https://api.github.com/gists/${this.GIST_ID}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${this.GITHUB_TOKEN}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            files: {
                                'aquarium-data.json': {
                                    content: JSON.stringify(data, null, 2)
                                }
                            }
                        })
                    });

                    if (response.ok) {
                        console.log('‚úÖ „Éá„Éº„Çø„ÇíGist„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                        return true;
                    }
                } catch (error) {
                    console.error('‚ùå Gist‰øùÂ≠ò„Ç®„É©„Éº:', error);
                }
                return true; // „Ç®„É©„Éº„Åß„ÇÇ„É≠„Éº„Ç´„É´‰øùÂ≠ò„ÅØÊàêÂäüÊâ±„ÅÑ
            }

            async loadFromGist() {
                if (!this.GIST_ID) return null;

                try {
                    const response = await fetch(`https://api.github.com/gists/${this.GIST_ID}`);
                    if (response.ok) {
                        const gist = await response.json();
                        const fileContent = gist.files['aquarium-data.json']?.content;
                        if (fileContent) {
                            console.log('‚úÖ Gist„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                            return JSON.parse(fileContent);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå GistË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                }
                return null;
            }

            startAutoSync() {
                if (!this.GIST_ID) return;
                
                setInterval(async () => {
                    const gistData = await this.loadFromGist();
                    if (gistData && this.shouldUpdate(gistData)) {
                        this.mergeData(gistData);
                        console.log('üîÑ „Éá„Éº„Çø„ÇíËá™ÂãïÂêåÊúü„Åó„Åæ„Åó„Åü');
                    }
                }, this.SYNC_INTERVAL);
            }

            shouldUpdate(remoteData) {
                const currentTimestamp = localStorage.getItem('last_sync_timestamp') || 0;
                return remoteData.timestamp > currentTimestamp;
            }

            mergeData(remoteData) {
                if (remoteData.aquariums) {
                    remoteData.aquariums.forEach(remoteAquarium => {
                        const existing = aquariums.find(a => a.id === remoteAquarium.id);
                        if (existing) {
                            existing.comment = remoteAquarium.comment || '';
                            existing.photo = remoteAquarium.photo || null;
                        } else {
                            aquariums.push(remoteAquarium);
                        }
                    });
                    
                    if (remoteData.nextId) {
                        nextAquariumId = Math.max(nextAquariumId, remoteData.nextId);
                    }
                    
                    renderAquariumList();
                    updateStats();
                    localStorage.setItem('last_sync_timestamp', remoteData.timestamp);
                }
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´„Ç§„É≥„Çπ„Çø„É≥„Çπ
        const dataSync = new AquariumDataSync();

        // „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å®Ë™≠„ÅøËæº„ÅøÔºàlocalStorage + GistÁâàÔºâ
        const STORAGE_KEY = 'aquarium_data_v1';
        
        async function saveToStorage() {
            try {
                const dataToSave = {
                    aquariums: aquariums,
                    nextId: nextAquariumId,
                    timestamp: Date.now()
                };
                
                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                
                // Á∑®ÈõÜÊ®©Èôê„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØGist„Å´„ÇÇ‰øùÂ≠ò
                if (isAuthenticated) {
                    await dataSync.saveToGist(dataToSave);
                }
                
                console.log('„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü:', aquariums.length, '‰ª∂');
                return true;
            } catch (e) {
                console.warn('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                return false;
            }
        }
        
        async function loadFromStorage() {
            try {
                // „Åæ„ÅöGist„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂèñÂæó„ÇíË©¶Ë°å
                const gistData = await dataSync.loadFromGist();
                let data = gistData;
                
                // Gist„ÅåÂà©Áî®„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ
                if (!data) {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (saved) {
                        data = JSON.parse(saved);
                    }
                }
                
                if (data && data.aquariums && Array.isArray(data.aquariums)) {
                    data.aquariums.forEach(savedAquarium => {
                        const existing = aquariums.find(a => a.id === savedAquarium.id);
                        if (existing) {
                            existing.comment = savedAquarium.comment || '';
                            existing.photo = savedAquarium.photo || null;
                        } else if (savedAquarium.id >= 9) {
                            aquariums.push(savedAquarium);
                        }
                    });
                    
                    if (data.nextId) {
                        nextAquariumId = data.nextId;
                    }
                    
                    console.log('„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                    return true;
                }
                return false;
            } catch (e) {
                console.warn('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                return false;
            }
        }
        // Ê∞¥ÊóèÈ§®„Éá„Éº„Çø
        const aquariums = [
            {
                id: 1,
                name: "„Éû„ÇØ„Çª„É´„Ç¢„ÇØ„Ç¢„Éë„Éº„ÇØÂìÅÂ∑ù",
                location: "Êù±‰∫¨ÈÉΩÊ∏ØÂå∫",
                lat: 35.6284,
                lng: 139.7387,
                description: "ÂìÅÂ∑ù„Éó„É™„É≥„Çπ„Éõ„ÉÜ„É´ÂÜÖ„Å´„ÅÇ„ÇãÈÉΩÂ∏ÇÂûãÊ∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 2,
                name: "„Åô„Åø„Å†Ê∞¥ÊóèÈ§®",
                location: "Êù±‰∫¨ÈÉΩÂ¢®Áî∞Âå∫",
                lat: 35.7101,
                lng: 139.8107,
                description: "Êù±‰∫¨„Çπ„Ç´„Ç§„ÉÑ„É™„Éº„Çø„Ç¶„É≥„Å´„ÅÇ„ÇãÈÉΩÂ∏ÇÂûãÊ∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 3,
                name: "„Ç¢„ÇØ„Ç¢„ÉØ„Éº„É´„ÉâËå®ÂüéÁúåÂ§ßÊ¥óÊ∞¥ÊóèÈ§®",
                location: "Ëå®ÂüéÁúåÊù±Ëå®ÂüéÈÉ°Â§ßÊ¥óÁî∫",
                lat: 36.3158,
                lng: 140.5746,
                description: "Êó•Êú¨Â±àÊåá„ÅÆÂ§ßÂûãÊ∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 4,
                name: "„Çµ„É≥„Ç∑„É£„Ç§„É≥Ê∞¥ÊóèÈ§®",
                location: "Êù±‰∫¨ÈÉΩË±äÂ≥∂Âå∫",
                lat: 35.7295,
                lng: 139.7196,
                description: "Ê±†Ë¢ã„Çµ„É≥„Ç∑„É£„Ç§„É≥„Ç∑„ÉÜ„Ç£„ÅÆÂ±ã‰∏ä„Å´„ÅÇ„ÇãÊ∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 5,
                name: "Êñ∞Ê±ü„ÉéÂ≥∂Ê∞¥ÊóèÈ§®",
                location: "Á•ûÂ•àÂ∑ùÁúåËó§Ê≤¢Â∏Ç",
                lat: 35.3075,
                lng: 139.4812,
                description: "Ê±ü„ÅÆÂ≥∂„Å®ÂØåÂ£´Â±±„ÇíÊúõ„ÇÄÁµ∂Â•Ω„ÅÆ„É≠„Ç±„Éº„Ç∑„Éß„É≥",
                comment: "",
                photo: null
            },
            {
                id: 6,
                name: "È≥•ÁæΩÊ∞¥ÊóèÈ§®",
                location: "‰∏âÈáçÁúåÈ≥•ÁæΩÂ∏Ç",
                lat: 34.4836,
                lng: 136.8452,
                description: "È£ºËÇ≤Á®ÆÈ°ûÊï∞Êó•Êú¨‰∏Ä„ÇíË™á„ÇãÊ∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 7,
                name: "ÂêçÂè§Â±ãÊ∏ØÊ∞¥ÊóèÈ§®",
                location: "ÊÑõÁü•ÁúåÂêçÂè§Â±ãÂ∏Ç",
                lat: 35.0915,
                lng: 136.8643,
                description: "Êó•Êú¨ÊúÄÂ§ßÁ¥ö„ÅÆÂ±ãÂ§ñÊ∞¥ÊßΩ„ÇíÊåÅ„Å§Ê∞¥ÊóèÈ§®",
                comment: "",
                photo: null
            },
            {
                id: 8,
                name: "ËëõË•øËá®Êµ∑Ê∞¥ÊóèÂúí",
                location: "Êù±‰∫¨ÈÉΩÊ±üÊà∏Â∑ùÂå∫",
                lat: 35.6344,
                lng: 139.8647,
                description: "Êù±‰∫¨Êπæ„Çí‰∏ÄÊúõ„Åß„Åç„ÇãÊ∞¥ÊóèÂúí",
                comment: "",
                photo: null
            }
        ];

        let map;
        let markers = [];
        let currentAquarium = null;
        let isAuthenticated = false;
        let nextAquariumId = 9; // Êñ∞„Åó„ÅÑÊ∞¥ÊóèÈ§®„ÅÆIDÁÆ°ÁêÜ
        
        // Á∑®ÈõÜÂèØËÉΩ„Å™„É¶„Éº„Ç∂„Éº„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ
        const authorizedPassword = 'yk1007';

        // Âú∞Âõ≥ÂàùÊúüÂåñ
        function initMap() {
            map = L.map('map').setView([35.6762, 139.6503], 6);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // „Éû„Éº„Ç´„ÉºËøΩÂä†
            aquariums.forEach(aquarium => {
                const marker = L.marker([aquarium.lat, aquarium.lng])
                    .addTo(map)
                    .bindPopup(`<b>${aquarium.name}</b><br>${aquarium.location}`)
                    .on('click', () => selectAquarium(aquarium.id));
                markers.push(marker);
            });
        }

        // Ê∞¥ÊóèÈ§®„É™„Çπ„ÉàË°®Á§∫
        function renderAquariumList() {
            const container = document.getElementById('aquarium-items');
            container.innerHTML = '';

            aquariums.forEach(aquarium => {
                const item = document.createElement('div');
                item.className = 'aquarium-item';
                item.onclick = () => selectAquarium(aquarium.id);
                item.innerHTML = `
                    <h3>${aquarium.name}</h3>
                    <div class="location">${aquarium.location}</div>
                `;
                container.appendChild(item);
            });
        }

        // Ê∞¥ÊóèÈ§®ÈÅ∏Êäû
        function selectAquarium(id) {
            const aquarium = aquariums.find(a => a.id === id);
            if (!aquarium) return;

            currentAquarium = aquarium;

            // „É™„Çπ„Éà„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Éè„Ç§„É©„Ç§„Éà
            document.querySelectorAll('.aquarium-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelectorAll('.aquarium-item')[id - 1].classList.add('selected');

            // Âú∞Âõ≥„ÅÆ‰∏≠ÂøÉ„ÇíÁßªÂãï
            map.setView([aquarium.lat, aquarium.lng], 10);

            // Ë©≥Á¥∞„Éë„Éç„É´Ë°®Á§∫
            showDetail(aquarium);
        }

        // Ë©≥Á¥∞„Éë„Éç„É´Ë°®Á§∫
        function showDetail(aquarium) {
            document.getElementById('detail-title').textContent = aquarium.name;
            document.getElementById('comment-textarea').value = aquarium.comment || '';
            
            const photoPreview = document.getElementById('photo-preview');
            if (aquarium.photo) {
                photoPreview.innerHTML = `<img src="${aquarium.photo}" alt="${aquarium.name}">`;
            } else {
                photoPreview.innerHTML = 'ÂÜôÁúü„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            }

            document.getElementById('detail-panel').classList.add('active');
        }

        // Ë©≥Á¥∞„Éë„Éç„É´Èñâ„Åò„Çã
        function closeDetail() {
            document.getElementById('detail-panel').classList.remove('active');
            document.querySelectorAll('.aquarium-item').forEach(item => {
                item.classList.remove('selected');
            });
            currentAquarium = null;
        }

        // ÂÜôÁúü„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        document.getElementById('photo-input').addEventListener('change', function(e) {
            if (!isAuthenticated) {
                showAuth();
                return;
            }
            
            const file = e.target.files[0];
            if (file && currentAquarium) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoPreview = document.getElementById('photo-preview');
                    photoPreview.innerHTML = `<img src="${e.target.result}" alt="${currentAquarium.name}">`;
                    currentAquarium.photo = e.target.result;
                    
                    const success = saveToStorage(); // ÂÜôÁúü„ÇÇËá™Âãï‰øùÂ≠ò
                    if (success) {
                        console.log('ÂÜôÁúü‰øùÂ≠òÂÆå‰∫Ü:', currentAquarium.name);
                    }
                    updateStats();
                };
                reader.readAsDataURL(file);
            }
        });

        // „Éá„Éº„Çø‰øùÂ≠ò
        function saveData() {
            if (!currentAquarium || !isAuthenticated) {
                showAuth();
                return;
            }

            const comment = document.getElementById('comment-textarea').value;
            currentAquarium.comment = comment;
            
            const success = saveToStorage(); // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            if (success) {
                alert('üíæ „Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„ÅüÔºÅ');
                console.log('„Ç≥„É°„É≥„Éà‰øùÂ≠òÂÆå‰∫Ü:', currentAquarium.name, '-', comment.substring(0, 50) + '...');
            } else {
                alert('‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
            updateStats();
        }
        
        // Ë™çË®ºÈñ¢ÈÄ£„ÅÆÈñ¢Êï∞
        function showAuth() {
            document.getElementById('auth-overlay').classList.add('active');
            document.getElementById('password-input').focus();
        }
        
        function closeAuth() {
            document.getElementById('auth-overlay').classList.remove('active');
            document.getElementById('password-input').value = '';
        }
        
        function authenticate() {
            const password = document.getElementById('password-input').value;
            
            if (password === authorizedPassword) {
                isAuthenticated = true;
                updateAuthStatus();
                closeAuth();
                alert('‚úÖ „É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„ÅüÔºÅÁ∑®ÈõÜ„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ');
            } else {
                alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ');
                document.getElementById('password-input').value = '';
            }
        }
        
        function updateAuthStatus() {
            const statusElement = document.getElementById('auth-status');
            const loginBtn = document.querySelector('.login-btn');
            const editControls = document.querySelectorAll('.edit-controls');
            const textarea = document.getElementById('comment-textarea');
            
            if (isAuthenticated) {
                statusElement.innerHTML = 'Á∑®ÈõÜ„É¢„Éº„Éâ';
                statusElement.style.background = 'rgba(46, 204, 113, 0.95)';
                statusElement.style.color = 'white';
                statusElement.style.borderColor = 'rgba(255, 255, 255, 0.4)';
                loginBtn.innerHTML = 'üîí';
                loginBtn.title = 'Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü';
                loginBtn.onclick = logout;
                loginBtn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                
                editControls.forEach(control => {
                    control.classList.add('visible');
                });
                
                // ËøΩÂä†„Éú„Çø„É≥„ÇíË°®Á§∫„ÉªÊúâÂäπÂåñ
                const addBtn = document.getElementById('add-aquarium-btn');
                if (addBtn) {
                    addBtn.classList.add('visible');
                    addBtn.disabled = false;
                }
                
                if (textarea) {
                    textarea.removeAttribute('readonly');
                }
            } else {
                statusElement.innerHTML = 'Èñ≤Ë¶ß„É¢„Éº„Éâ';
                statusElement.style.background = 'rgba(255, 255, 255, 0.95)';
                statusElement.style.color = '#2c3e50';
                statusElement.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                loginBtn.innerHTML = 'üîì';
                loginBtn.title = 'Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥';
                loginBtn.onclick = showAuth;
                loginBtn.style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
                
                editControls.forEach(control => {
                    control.classList.remove('visible');
                });
                
                // ËøΩÂä†„Éú„Çø„É≥„ÇíÈùûË°®Á§∫„ÉªÁÑ°ÂäπÂåñ
                const addBtn = document.getElementById('add-aquarium-btn');
                if (addBtn) {
                    addBtn.classList.remove('visible');
                    addBtn.disabled = true;
                }
                
                // ËøΩÂä†„Éï„Ç©„Éº„É†„ÇíÈñâ„Åò„Çã
                cancelAddForm();
                
                if (textarea) {
                    textarea.setAttribute('readonly', 'readonly');
                }
            }
        }
        
        function logout() {
            isAuthenticated = false;
            updateAuthStatus();
            alert('Èñ≤Ë¶ß„É¢„Éº„Éâ„Å´Êàª„Çä„Åæ„Åó„Åü„ÄÇ');
        }
        
        // Êñ∞„Åó„ÅÑÊ∞¥ÊóèÈ§®ËøΩÂä†Ê©üËÉΩ
        function toggleAddForm() {
            if (!isAuthenticated) {
                showAuth();
                return;
            }
            
            const form = document.getElementById('add-form');
            const isVisible = form.classList.contains('active');
            
            if (isVisible) {
                cancelAddForm();
            } else {
                form.classList.add('active');
                document.getElementById('new-name').focus();
            }
        }
        
        function cancelAddForm() {
            const form = document.getElementById('add-form');
            form.classList.remove('active');
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('new-name').value = '';
            document.getElementById('new-location').value = '';
            document.getElementById('new-description').value = '';
            
            // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
            const addBtn = document.getElementById('add-btn');
            addBtn.textContent = 'ËøΩÂä†';
            addBtn.disabled = false;
        }
        
        // ‰ΩèÊâÄ„Åã„ÇâÁ∑ØÂ∫¶ÁµåÂ∫¶„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞ÔºàNominatim API‰ΩøÁî®Ôºâ
        async function getCoordinatesFromAddress(address) {
            try {
                // Nominatim APIÔºàOpenStreetMap„ÅÆÁÑ°Êñô„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Çµ„Éº„Éì„ÇπÔºâ
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&countrycodes=jp&limit=1`;
                
                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'AquariumRecordApp/1.0'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞API„Åã„Çâ„ÅÆÂøúÁ≠î„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                }
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon),
                        displayName: data[0].display_name
                    };
                } else {
                    throw new Error('‰ΩèÊâÄ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
            } catch (error) {
                console.error('„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Ç®„É©„Éº:', error);
                throw error;
            }
        }
        
        async function addNewAquarium() {
            const name = document.getElementById('new-name').value.trim();
            const location = document.getElementById('new-location').value.trim();
            const description = document.getElementById('new-description').value.trim();
            const addBtn = document.getElementById('add-btn');
            
            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (!name || !location) {
                alert('‚ùå Ê∞¥ÊóèÈ§®Âêç„Å®ÊâÄÂú®Âú∞„ÅØÂøÖÈ†à„Åß„Åô„ÄÇ');
                return;
            }
            
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ„Åó„Å¶„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            addBtn.textContent = '‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó‰∏≠...';
            addBtn.disabled = true;
            
            try {
                // ‰ΩèÊâÄ„Åã„ÇâÁ∑ØÂ∫¶ÁµåÂ∫¶„ÇíÂèñÂæó
                const coordinates = await getCoordinatesFromAddress(location);
                
                // Êñ∞„Åó„ÅÑÊ∞¥ÊóèÈ§®„ÇíËøΩÂä†
                const newAquarium = {
                    id: nextAquariumId++,
                    name: name,
                    location: location,
                    lat: coordinates.lat,
                    lng: coordinates.lng,
                    description: description || 'Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„ÅüÊ∞¥ÊóèÈ§®',
                    comment: '',
                    photo: null
                };
                
                aquariums.push(newAquarium);
                
                // Âú∞Âõ≥„Å´„Éû„Éº„Ç´„Éº„ÇíËøΩÂä†
                const marker = L.marker([coordinates.lat, coordinates.lng])
                    .addTo(map)
                    .bindPopup(`<b>${name}</b><br>${location}`)
                    .on('click', () => selectAquarium(newAquarium.id));
                markers.push(marker);
                
                // UI„ÇíÊõ¥Êñ∞
                renderAquariumList();
                updateStats();
                cancelAddForm();
                
                const success = saveToStorage();
                if (success) {
                    alert(`‚úÖ ${name} „ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ\nüìç ${coordinates.displayName}\nüíæ „Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü`);
                } else {
                    alert(`‚úÖ ${name} „ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ\nüìç ${coordinates.displayName}\n‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü`);
                }
                
                // Âú∞Âõ≥„ÇíÊñ∞„Åó„ÅÑÊ∞¥ÊóèÈ§®„Å´ÁßªÂãï
                map.setView([coordinates.lat, coordinates.lng], 12);
                
            } catch (error) {
                alert(`‚ùå ‰ΩèÊâÄ„Åã„Çâ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ\n\nÂéüÂõ†Ôºö${error.message}\n\nüí° „Çà„ÇäË©≥Á¥∞„Å™‰ΩèÊâÄÔºàÂ∏ÇÂå∫Áî∫Êùë„Åæ„ÅßÔºâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                
                // „Éú„Çø„É≥„ÇíÂÖÉ„Å´Êàª„Åô
                addBtn.textContent = 'ËøΩÂä†';
                addBtn.disabled = false;
            }
        }
        
        // Enter„Ç≠„Éº„Åß„É≠„Ç∞„Ç§„É≥
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('auth-overlay').classList.contains('active')) {
                authenticate();
            }
        });

        // Áµ±Ë®àÊõ¥Êñ∞
        function updateStats() {
            const photosCount = aquariums.filter(a => a.photo).length;
            const commentsCount = aquariums.filter(a => a.comment && a.comment.trim()).length;
            const totalCount = aquariums.length;
            
            // ÈÉΩÈÅìÂ∫úÁúåÊï∞„ÇíË®àÁÆó
            const prefectures = new Set();
            aquariums.forEach(a => {
                const prefecture = a.location.match(/[ÈÉΩÈÅìÂ∫úÁúå]/);
                if (prefecture) {
                    const prefName = a.location.substring(0, a.location.indexOf(prefecture[0]) + 1);
                    prefectures.add(prefName);
                }
            });

            document.getElementById('photos-count').textContent = photosCount;
            document.getElementById('comments-count').textContent = commentsCount;
            document.querySelector('.stat-item .stat-number').textContent = totalCount;
            document.querySelectorAll('.stat-item .stat-number')[1].textContent = prefectures.size;
        }

        // ÂàùÊúüÂåñÔºàLeaflet„É©„Ç§„Éñ„É©„É™„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫Ü„ÇíÂæÖ„Å§Ôºâ
        async function initializeApp() {
            try {
                // ‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
                const loaded = loadFromStorage();
                if (loaded) {
                    console.log('üíæ ‰ª•Ââç„ÅÆ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü');
                }
                
                await waitForLeaflet();
                initMap();
                renderAquariumList();
                updateStats();
                updateAuthStatus(); // Ë™çË®ºÁä∂ÊÖã„ÅÆÂàùÊúüÂåñ
                
                // Ëá™ÂãïÂêåÊúü„ÇíÈñãÂßãÔºàGistË®≠ÂÆö„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºâ
                dataSync.startAutoSync();
                
                // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
                console.log('üê† Ê∞¥ÊóèÈ§®„Çµ„Ç§„Éà„ÅåÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü');
                console.log('ÁèæÂú®„ÅÆÊ∞¥ÊóèÈ§®Êï∞:', aquariums.length);
                console.log('ÂÜôÁúü„ÅÇ„Çä:', aquariums.filter(a => a.photo).length);
                console.log('„Ç≥„É°„É≥„Éà„ÅÇ„Çä:', aquariums.filter(a => a.comment && a.comment.trim()).length);
                
            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºöÂú∞Âõ≥„Å™„Åó„Åß„ÇÇ„É™„Çπ„Éà„ÅØË°®Á§∫
                renderAquariumList();
                updateStats();
                updateAuthStatus();
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
</body>
</html>
